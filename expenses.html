<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>e.nue 支出管理（レシート単位）</title>
<style>
:root{
  --bg0:#f3ede4; --bg1:#f7f2ea;
  --glass:rgba(255,255,255,.88); --glass2:rgba(255,255,255,.96);
  --line:rgba(120,90,40,.18);
  --shadow:0 18px 40px rgba(120,90,40,.18);
  --text:#2f2a22; --muted:rgba(47,42,34,.45);
  --r:18px;
}
*{box-sizing:border-box}
body{
  margin:0; color:var(--text);
  font-family:system-ui,-apple-system,"Segoe UI","Noto Sans JP",sans-serif;
  background:linear-gradient(135deg,var(--bg0),var(--bg1));
}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
.card{
  background:linear-gradient(180deg,var(--glass),var(--glass2));
  border-radius:var(--r); box-shadow:var(--shadow); padding:16px;
}
h1{margin:0 0 6px;font-size:18px}
.sub{color:var(--muted);font-size:13px;margin-bottom:12px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left}
th{background:#faf8f5}
.empty{padding:20px;color:var(--muted)}
.btn{
  border:none;border-radius:999px;padding:10px 14px;background:#fff;
  box-shadow:var(--shadow);cursor:pointer;font-weight:700;
}
.top{display:flex;justify-content:space-between;align-items:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <h1>支出管理（レシート単位）</h1>
    <div>
      <button class="btn" onclick="location.href='index.html'">← 戻る</button>
      <button class="btn" onclick="location.href='receipt_claims.html'">領収申請</button>
    </div>
  </div>

  <div class="card">
    <div class="sub">購入店ごとにレシートを登録 → 明細にカテゴリを付与</div>
    <table>
      <thead>
        <tr><th>日付</th><th>購入店</th><th>合計</th><th>メモ</th></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <div id="empty" class="empty" style="display:none">表示できる支出がありません</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore,collection,getDocs,query,orderBy } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAhPCgPoJK6S6BWVcBZOruYqMPXVQXQFRk",
  authDomain: "handmade-pos.firebaseapp.com",
  projectId: "handmade-pos",
  storageBucket: "handmade-pos.firebasestorage.app",
  messagingSenderId: "174873514252",
  appId: "1:174873514252:web:c26659bffca850d475f929"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

async function load(){
  const qy = query(collection(db,"expense_receipts"), orderBy("date","desc"));
  const snap = await getDocs(qy);
  const tbody = document.getElementById("tbody");
  const empty = document.getElementById("empty");
  tbody.innerHTML = "";
  if(snap.empty){ empty.style.display=""; return; }
  empty.style.display="none";
  snap.forEach(d=>{
    const r = d.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${r.date||"-"}</td><td>${r.store||""}</td><td>¥${(r.sum||0).toLocaleString()}</td><td>${r.memo||""}</td>`;
    tbody.appendChild(tr);
  });
}

onAuthStateChanged(auth, async (u)=>{
  if(!u){ location.href="login.html"; return; }
  await load();
});
</script>
</body>
</html>
