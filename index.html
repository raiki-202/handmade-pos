<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>e.nue Dashboard</title>

<style>
:root{
  --bg1:#e3ddd4;
  --bg2:#d4ccc1;

  --glass-bg: rgba(255,255,255,.86);
  --glass-bg2: rgba(255,255,255,.78);
  --glass-border: rgba(0,0,0,.06);
  --line-soft: rgba(0,0,0,.10);
  --shadow: 0 18px 45px rgba(0,0,0,.14);

  --text-main:#222222;
  --text-sub:#555555;
  --muted: rgba(34,34,34,.55);

  --accent:#e18a6a;
  --accent2:#d06463;

  --ok:#2fbf7a;
  --wait:#f0a33a;
  --done:#6d78d8;
  --todo:#9097a6;

  --r:18px;
  --maxw:980px;

  /* otherpage tiles */
  --safe-pad:14px;
  --gap:10px;
  --tile-r:18px;
  --blur:16px;
  --shadow2: 0 10px 26px rgba(0,0,0,.10);
  --icon: rgba(0,0,0,.72);
  --tile-size: calc((100vw - (var(--safe-pad) * 2) - (var(--gap) * 2)) / 3);

}

*{ box-sizing:border-box; }
html, body{ height:100%; }

body{
  margin:0;
  font-family: system-ui,-apple-system,"Segoe UI","Noto Sans JP",sans-serif;
  color:var(--text-main);
  background:
    radial-gradient(1200px 800px at 18% 8%, rgba(225,138,106,.18), transparent 55%),
    radial-gradient(1200px 800px at 88% 0%, rgba(208,100,99,.14), transparent 52%),
    linear-gradient(135deg,var(--bg1),var(--bg2));
}

.safe{
  padding:max(14px,env(safe-area-inset-top)) 14px max(18px,env(safe-area-inset-bottom));
  max-width:var(--maxw);
  margin:0 auto;
}

/* ===== top bar ===== */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:6px 0 14px;
}
.brand{ font-weight:900; letter-spacing:.02em; }

.tabs{
  display:flex; gap:4px; padding:4px;
  border-radius:999px;
  background:rgba(255,255,255,.55);
  border:1px solid var(--glass-border);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}
.tab{
  border:0; background:transparent;
  padding:10px 14px; border-radius:999px;
  font-weight:800; cursor:pointer;
  color:rgba(34,34,34,.65);
}
.tab.active{
  background:rgba(255,255,255,.85);
  color:var(--text-main);
  box-shadow:0 8px 18px rgba(0,0,0,.08);
}

/* ===== layout ===== */
.grid{ display:flex; flex-direction:column; gap:14px; }

.card{
  background:linear-gradient(180deg,var(--glass-bg),var(--glass-bg2));
  border:1px solid var(--glass-border);
  border-radius:var(--r);
  box-shadow:var(--shadow);
  overflow:hidden;
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}

/* =====================================================
   â€œé3Dâ€ flipï¼ˆSafariã§ã‚‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å£Šã‚Œãªã„ï¼‰
===================================================== */
.hint{ display:none; }
.cardFlip{ position:relative; cursor:pointer; }
.cardFlipInner{
  position:relative;
  min-height:360px;
}

/* 2é¢ã‚’é‡ã­ã¦ãƒ•ã‚§ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆtransformç„¡ã—ï¼‰ */
.cardFace{
  position:absolute;
  inset:0;
  background: linear-gradient(180deg,var(--glass-bg),var(--glass-bg2));
  opacity:0;
  pointer-events:none;
  transition: opacity .75s ease;
  will-change: opacity, filter;
}
.cardFace.front{ opacity:1; pointer-events:auto; }
.cardFlip.is-flipped .cardFace.front{ opacity:0; pointer-events:none; }
.cardFlip.is-flipped .cardFace.back { opacity:1; pointer-events:auto; }

/* ä¸Šå“ãªåˆ‡æ›¿æ¼”å‡º */
.cardFace::after{
  content:"";
  position:absolute;
  inset:-20%;
  pointer-events:none;
  opacity:0;
  background:
    radial-gradient(800px 520px at 18% 20%, rgba(255,255,255,.55), transparent 60%),
    radial-gradient(900px 560px at 85% 10%, rgba(225,138,106,.20), transparent 62%),
    radial-gradient(900px 640px at 80% 90%, rgba(208,100,99,.14), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,0));
  filter: blur(10px);
  transform: translateY(-6px);
  transition: opacity .75s ease, transform .75s ease, filter .75s ease;
}
.cardFlip.is-animating .cardFace{ filter: blur(2.2px) saturate(1.03); }
.cardFlip.is-animating .cardFace::after{
  opacity:1;
  transform: translateY(0);
  filter: blur(14px);
}

/* ===== card head ===== */
.cardHead{
  display:flex; justify-content:space-between;
  gap:10px;
  padding:14px 14px 10px;
  border-bottom:1px solid rgba(0,0,0,.06);
}
.title .h{ font-weight:900; font-size:14px; letter-spacing:.06em; }
.title .s{ font-size:12px; color:rgba(34,34,34,.6); }

.badgeBig{
  text-align:right;
  min-width: 88px;
  flex: 0 0 auto;
}
.badgeBig .k{
  font-size:11px; font-weight:800; color:rgba(34,34,34,.55);
  white-space:nowrap;
  display:inline-block;
}
.badgeBig .v{ font-size:18px; font-weight:900; }

/* ===== chart ===== */
.chartWrap{
  padding:12px 0;
  overflow:hidden;
  cursor:default;
}
.chartFrame{ position:relative; padding:0 12px 10px; }

.yAxisFixed{
  position:absolute; left:12px; top:0;
  width:42px; height:220px;
  pointer-events:none;
  z-index:2;
}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é ˜åŸŸ */
.chartScroller{
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling:touch;
  touch-action: pan-x;
}

/* å·¦ä½™ç™½ï¼ˆYè»¸å›ºå®šåˆ†ï¼‰ */
.chartInner{
  padding-left:42px;
  display:inline-block;
}
.chartMount{
  display:inline-block;
}
.chartMount svg{
  display:block;
  pointer-events:none;
  user-select:none;
  -webkit-user-select:none;
}

/* ===== tooltipï¼ˆSVGå†…ï¼‰ ===== */
.chartTooltip{ pointer-events:none; }
.chartTooltip rect{ fill: rgba(34,34,34,.92); rx:8; }
.chartTooltip text{ fill:#fff; font-size:12px; font-weight:900; }

/* ===== section2 (calendar) ===== */
:root{ --cell:52px; } /* fallback */
.secCal .calendar{ padding:12px; }
.secCal .calBox{
  border-radius:14px;
  border:1px solid rgba(0,0,0,.08);
  background:rgba(255,255,255,.60);
  overflow:hidden;
}
.secCal .calTop{
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 10px 8px;
  font-weight:900; gap:10px;
}
.secCal .calTopLeft,.secCal .calTopRight{ display:flex; align-items:center; gap:8px; }
.secCal .navBtn,.secCal .todayBtn,.secCal .modeBtn{
  appearance:none; border:1px solid rgba(0,0,0,.10);
  background:rgba(255,255,255,.75);
  border-radius:999px;
  padding:8px 10px;
  font-weight:900;
  font-size:12px;
  box-shadow: 0 8px 18px rgba(0,0,0,.08);
  cursor:pointer;
}
.secCal .navBtn:active,.secCal .todayBtn:active,.secCal .modeBtn:active{ transform:translateY(1px); }
.secCal .navBtn[disabled]{ opacity:.35; cursor:not-allowed; }
.secCal .monthLabel{ font-weight:1000; letter-spacing:.2px; }
.secCal .calViewport{ position:relative; overflow:hidden; border-top:1px solid rgba(0,0,0,.06); }
.secCal .calGrid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:1px;
  background:rgba(0,0,0,.08);
  will-change: transform, opacity;
}
.secCal .dow,.secCal .day{
  background:rgba(255,255,255,.62);
  padding:6px;
  font-size:12px;
  min-height: var(--cell);
  height: var(--cell);
}
.secCal .dow{
  text-align:center;
  font-weight:1000;
  display:flex; align-items:center; justify-content:center;
  user-select:none;
}
.secCal .day{
  position:relative;
  display:flex;
  flex-direction:column;
  gap:6px;
  border:none;
  width:100%;
  text-align:left;
  cursor:pointer;
  user-select:none;
  touch-action:manipulation;
}
.secCal .day.dim{ opacity:.45; }
.secCal .num{
  font-weight:1000;
  line-height:1;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:26px; height:26px;
  border-radius:999px;
}
.secCal .centerMark{
  margin-top:auto;
  margin-bottom:4px;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height: 22px;
}
.secCal .stamp{
  display:inline-grid;
  grid-template-rows:auto auto;
  place-items:center;
  padding:6px 10px 7px;
  border-radius:999px;
  border:2px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.78);
  box-shadow:
    0 10px 18px rgba(0,0,0,.10),
    inset 0 0 0 2px rgba(225,138,106,.35);
  transform: rotate(-10deg);
}
.secCal .stamp span{
  font-weight:1000;
  font-size:11px;
  line-height:1.05;
  letter-spacing:.6px;
  color: var(--accent2);
}
.secCal .eventDot{
  width:10px; height:10px;
  border-radius:999px;
  box-shadow:
    0 10px 16px rgba(0,0,0,.10),
    inset 0 0 0 2px rgba(255,255,255,.85);
}
.secCal .eventDot.orange{ background: rgba(225,138,106,.95); }
.secCal .eventDot.blue{ background: rgba(109,120,216,.95); }
.secCal .eventDot.red{ background: rgba(208,100,99,.95); }
.secCal .eventDot.gray{ background: rgba(34,34,34,.28); }
.secCal .day.dim .eventDot,
.secCal .day.dim .stamp{ opacity:.45; transform: rotate(-10deg) scale(.92); }

/* åœŸæ—¥ãƒ»ç¥ */
.secCal .day.sun{ background: linear-gradient(180deg, rgba(255,255,255,.62), rgba(255,255,255,.62)), rgba(208,100,99,.16); }
.secCal .day.sat{ background: linear-gradient(180deg, rgba(255,255,255,.62), rgba(255,255,255,.62)), rgba(109,120,216,.16); }
.secCal .day.holiday{ background: linear-gradient(180deg, rgba(255,255,255,.62), rgba(255,255,255,.62)), rgba(208,100,99,.20); }
.secCal .day.sun .num, .secCal .day.holiday .num{ color: var(--accent2); }
.secCal .day.sat .num{ color: rgba(109,120,216,.95); }

/* ä»Šæ—¥ */
.secCal .day.today .num{
  box-shadow:
    0 0 0 2px rgba(225,138,106,.30),
    0 0 14px rgba(225,138,106,.45);
  background: rgba(255,255,255,.75);
}

/* ã‚¹ãƒ©ã‚¤ãƒ‰ */
.secCal .slideEnterRight{ transform: translateX(14%); opacity:0; }
.secCal .slideEnterLeft { transform: translateX(-14%); opacity:0; }
.secCal .slideActive{ transform: translateX(0%); opacity:1; transition: transform .28s ease, opacity .28s ease; }
.secCal .slideExitLeft{ transform: translateX(-14%); opacity:0; transition: transform .28s ease, opacity .28s ease; position:absolute; inset:0; }
.secCal .slideExitRight{ transform: translateX(14%); opacity:0; transition: transform .28s ease, opacity .28s ease; position:absolute; inset:0; }

/* å¹ãå‡ºã—ï¼ˆclassåã¯ .popover ã«çµ±ä¸€ï¼‰ */
.popover{
  position:fixed;
  z-index:9999;
  max-width:min(320px, calc(100vw - 28px));
  background: rgba(255,255,255,.92);
  border:1px solid rgba(0,0,0,.10);
  border-radius:14px;
  box-shadow: 0 22px 55px rgba(0,0,0,.18);
  padding:10px 12px;
  transform-origin: top left;
  animation: secCalPop .12s ease;
}
@keyframes secCalPop{
  from{ transform: scale(.98); opacity:0; }
  to{ transform: scale(1); opacity:1; }
}
.secCal .popHead{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
.secCal .popTitle{ font-weight:1000; }
.secCal .popSub{ font-size:12px; color:rgba(0,0,0,.55); margin-top:2px; }
.secCal .iconBtn{
  appearance:none;
  border:1px solid rgba(0,0,0,.10);
  background:rgba(255,255,255,.75);
  border-radius:12px;
  padding:6px 8px;
  cursor:pointer;
  box-shadow: 0 8px 18px rgba(0,0,0,.08);
  font-weight:1000;
  font-size:14px;
  line-height:1;
}
.secCal .iconBtn:active{ transform:translateY(1px); }
.secCal .popRow{ margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; }
.secCal .badge{
  display:inline-flex; align-items:center; gap:6px;
  font-size:12px; font-weight:900;
  padding:6px 10px;
  border-radius:999px;
  background: rgba(225,138,106,.16);
  border: 1px solid rgba(225,138,106,.28);
}
.secCal .badge.blue{ background: rgba(109,120,216,.14); border-color: rgba(109,120,216,.24); }
.secCal .badge.red{ background: rgba(208,100,99,.14); border-color: rgba(208,100,99,.24); }
.secCal .editBox{
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  border:1px dashed rgba(0,0,0,.18);
  background: rgba(255,255,255,.72);
  display:none;
}
.secCal .editBox.show{ display:block; }
.secCal .editBox label{ display:block; font-size:12px; color:rgba(0,0,0,.55); font-weight:900; margin-bottom:6px; }
.secCal .editRow{ display:flex; gap:8px; align-items:center; }
.secCal .dateInput{
  flex:1; appearance:none;
  border:1px solid rgba(0,0,0,.14);
  border-radius:12px;
  padding:10px 10px;
  background: rgba(255,255,255,.85);
  font-weight:900;
}
.secCal .saveBtn{
  appearance:none; border:none;
  border-radius:12px;
  padding:10px 12px;
  font-weight:1000;
  background: rgba(225,138,106,.95);
  color:#fff;
  box-shadow: 0 10px 18px rgba(0,0,0,.12);
  cursor:pointer;
}
.secCal .saveBtn:active{ transform:translateY(1px); }
.secCal .note{ margin-top:8px; font-size:11px; color:rgba(0,0,0,.55); opacity:.85; }
.secCal .closeHint{ margin-top:10px; font-size:11px; color: rgba(0,0,0,.55); opacity:.75; }

@supports (aspect-ratio: 1 / 1){
  .secCal .day{ aspect-ratio: 1 / 1; height:auto; min-height:auto; }
  .secCal .dow{ height:auto; min-height:34px; }
}
@media (max-width: 380px){
  .secCal .calendar{ padding:10px; }
  .secCal .dow,.secCal .day{ padding:5px; }
  .secCal .num{ width:24px; height:24px; }
}

/* ===== section3/4 (orders tables) ===== */
.secOrders .tableWrap{ overflow:auto; -webkit-overflow-scrolling:touch; }
.secOrders .ordersTable{ width:100%; border-collapse:collapse; min-width:720px; }
.secOrders .ordersTable th,.secOrders .ordersTable td{ padding:10px; font-size:13px; vertical-align:middle; }
.secOrders .cellText{ white-space:nowrap; }
.secOrders .ordersTable th{ text-align:left; background:#f3f3f3; position:sticky; top:0; z-index:1; }
.secOrders .ordersTable tr+tr td{ border-top:1px solid rgba(0,0,0,.06); }

.secOrders .tap{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.10);
  background:rgba(255,255,255,.7);
  cursor:pointer;
  user-select:none;
  max-width:100%;
}
.secOrders .tap:active{ transform: translateY(1px); }

.secOrders .nameBtn{
  border:none; background:transparent; padding:0; margin:0;
  cursor:pointer; text-align:left; font:inherit; color:inherit;
  display:inline-flex; align-items:center; gap:8px;
}
.secOrders .nameBtn .chev{ opacity:.55; font-weight:900; }
.secOrders .duePill{ white-space:nowrap; }

.secOrders .statusPill{
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px;
  border-radius:999px;
  border:2px solid rgba(0,0,0,.12);
  font-weight:900;
  background:rgba(255,255,255,.85);
  white-space:nowrap;
}
.secOrders .dot{
  width:8px; height:8px; border-radius:50%;
  background:rgba(0,0,0,.35);
  box-shadow:0 0 0 3px rgba(0,0,0,.06);
  flex:0 0 auto;
}
.secOrders .s-michakushu{ border-color: rgba(139,139,139,.55); }
.secOrders .s-michakushu .dot{ background:rgba(62,62,62,1); box-shadow:0 0 0 3px rgba(139,139,139,.18); }

.secOrders .s-nyuukin{ border-color: rgba(240,163,58,.70); }
.secOrders .s-nyuukin .dot{ background:rgba(185,98,0,1); box-shadow:0 0 0 3px rgba(240,163,58,.22); }

.secOrders .s-shinkochu{ border-color: rgba(47,191,122,.70); }
.secOrders .s-shinkochu .dot{ background:rgba(15,122,69,1); box-shadow:0 0 0 3px rgba(47,191,122,.20); }

/* å®Œäº†ï¼ˆä¿é™ºã€‚è¡¨ç¤ºã¯ã—ãªã„ãƒ•ã‚£ãƒ«ã‚¿ã ã‘ã©ï¼‰ */
.secOrders .s-done{ border-color: rgba(109,120,216,.70); }
.secOrders .s-done .dot{ background:rgba(66,76,175,1); box-shadow:0 0 0 3px rgba(109,120,216,.20); }

.secOrders .chips{ display:flex; flex-wrap:wrap; gap:6px; justify-content:flex-end; }
.secOrders .chip{
  display:inline-flex; align-items:center;
  padding:5px 8px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.14);
  background:rgba(0,0,0,.03);
  font-weight:800;
  white-space:nowrap;
}
.secOrders .chip.muted{ opacity:.55; font-weight:700; }
.emptyOrders{ padding:18px 14px; color:rgba(0,0,0,.55); font-weight:800; }

/* mobile card rows */
@media (max-width: 620px){
  .secOrders .tableWrap{ overflow:visible; }
  .secOrders .ordersTable{ min-width:0; }
  .secOrders .ordersTable thead{ display:none; }
  .secOrders .ordersTable tr{ display:block; padding:10px 12px; border-top:1px solid rgba(0,0,0,.07); }
  .secOrders .ordersTable tr:first-child{ border-top:none; }
  .secOrders .ordersTable tr+tr td{ border-top:none; }
  .secOrders .ordersTable td{ display:flex; justify-content:space-between; align-items:center; padding:8px 0; font-size:13px; }
  .secOrders .ordersTable td::before{
    content: attr(data-label);
    color:rgba(0,0,0,.55);
    font-weight:800;
    margin-right:10px;
    flex:0 0 auto;
  }
}

/* bottom sheet (shared) */
.enueOverlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  align-items:flex-end;
  z-index:999;
  padding:10px;
}
.enueOverlay.show{ display:flex; }
.enueSheet{
  width:min(640px,100%);
  margin:0 auto;
  background:#fff;
  border-radius:22px;
  box-shadow:0 30px 80px rgba(0,0,0,.35);
  overflow:hidden;
}
.enueSheetHead{
  padding:12px 14px;
  border-bottom:1px solid rgba(0,0,0,.08);
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  font-weight:900;
}
.enueSheetBody{ padding:12px 14px; }
.enueSheetFoot{
  padding:12px 14px;
  border-top:1px solid rgba(0,0,0,.08);
  display:flex; gap:10px;
}
.enueBtn{
  flex:1;
  border:none;
  border-radius:14px;
  padding:12px 12px;
  font-weight:900;
  cursor:pointer;
}
.enueBtnGhost{ background:rgba(0,0,0,.06); }
.enueBtnPrimary{ background:#111; color:#fff; }

.enueOptList{ display:grid; gap:10px; }
.enueOpt{
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 12px;
  border-radius:16px;
  border:1px solid rgba(0,0,0,.12);
  cursor:pointer;
  user-select:none;
}
.enueOpt:active{ transform: translateY(1px); }
.enueOpt .left{ display:flex; align-items:center; gap:10px; font-weight:900; }
.enueOpt .right{ color:rgba(0,0,0,.55); font-weight:800; }
.enueCheck{
  width:18px; height:18px;
  border-radius:6px;
  border:2px solid rgba(0,0,0,.25);
  background:transparent;
  display:inline-flex; align-items:center; justify-content:center;
  font-size:12px; font-weight:900;
}
.enueCheck.on{ background:#111; border-color:#111; color:#fff; }

.enueHiddenDate{
  position:fixed; left:-9999px; top:-9999px;
  opacity:0; pointer-events:none;
}

@media (prefers-reduced-motion: reduce){
  .cardFace{ transition:none; }
  .cardFlip.is-animating .cardFace{ filter:none; }
  .cardFace::after{ transition:none; }
}


/* ===== OTHER page tiles (merged) ===== */
/* OTHER */
.otherCard{ padding:14px; }
.tileGrid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--gap);
}

.tile{
  position:relative;
  appearance:none;
  -webkit-appearance:none;
  width:100%;
  height: var(--tile-size);  /* â† iPhoneã§ç¢ºå®Ÿã«åã‚ã‚‹ */
  border-radius: var(--tile-r);

  border: 1px solid rgba(255,255,255,.62);
  background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.10));
  box-shadow: var(--shadow2);

  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));

  padding: 11px;
  text-align:left;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;

  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  gap:6px;

  transition: transform .08s ease, background .12s ease, border-color .12s ease;
}
.tile::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: var(--tile-r);
  pointer-events:none;
  border: 1px solid rgba(0,0,0,.06);
}
.tile:active{ transform: scale(.985); }
.tile:hover{
  background: linear-gradient(180deg, rgba(255,255,255,.30), rgba(255,255,255,.14));
  border-color: rgba(255,255,255,.75);
}

/* ã‚¢ã‚¤ã‚³ãƒ³ */
.tileIcon{
  position:absolute;
  top:10px;
  left:10px;
  width:26px;
  height:26px;
  display:grid;
  place-items:center;
  opacity:.95;
}
.tileIcon svg{
  width:26px;
  height:26px;
  stroke: var(--icon);
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.tileTitle{ font-weight:900; font-size:13px; line-height:1.2; }
.tileSub{ font-weight:700; font-size:10.5px; color: rgba(34,34,34,.60); line-height:1.2; }

/* ã•ã‚‰ã«å°ã•ã„ç«¯æœ«ï¼ˆSEç´šï¼‰ã§ã‚‚ä½™è£•ã‚’ä½œã‚‹ */
@media (max-width: 360px){
  :root{
    --safe-pad: 12px;
    --gap: 8px;
    --tile-size: calc((100vw - (var(--safe-pad) * 2) - (var(--gap) * 2)) / 3);
  }
  .tile{ padding:10px; }
  .tileIcon{ top:9px; left:9px; width:24px; height:24px; }
  .tileIcon svg{ width:24px; height:24px; }
}

/* iPadä»¥ä¸Šã¯å°‘ã—å¤§ããï¼ˆè¦‹ã‚„ã™ã•ï¼‰ */
@media (min-width: 600px){
  :root{ --tile-size: 160px; --gap: 12px; }
  .tileTitle{ font-size:14px; }
  .tileSub{ font-size:11px; }
}
@media (min-width: 900px){
  :root{ --tile-size: 180px; }
}

</style>
</head>

<body>
  <div class="safe">
    <div class="topbar">
      <div class="brand">e.nue</div>
      <div class="tabs" role="tablist" aria-label="page switch">
        <button class="tab active" data-view="home" type="button">HOME</button>
        <button class="tab" data-view="other" type="button">OTHER</button>
      </div>
    </div>

    <!-- HOME -->
    <main id="view-home" class="grid">

      <!-- 1) ã‚°ãƒ©ãƒ•ï¼ˆåˆ‡æ›¿ï¼‰ -->
      <section class="card cardFlip" id="card-chart">
        <div class="cardFlipInner">

          <!-- FRONTï¼šå—æ³¨ä»¶æ•° -->
          <div class="cardFace front">
            <div class="cardHead">
              <div class="title">
                <div class="h" id="chartTitleA">å—æ³¨ä»¶æ•°ã®æ¨ç§»</div>
                <div class="s">æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼šéå»1å¹´åˆ†ï¼ˆè¡¨ç¤ºä¸­ç¯„å›²ã§ç¸¦è»¸ãŒè‡ªå‹•èª¿æ•´ï¼‰</div>
              </div>
              <div class="badgeBig">
                <div class="k" id="metricLabelA">å—æ³¨ä»¶æ•°</div>
                <div class="v" id="metricValueA">â€”</div>
              </div>
            </div>

            <div class="chartWrap">
              <div class="chartFrame">
                <div class="yAxisFixed" id="yAxisFixedA"></div>
                <div class="chartScroller" id="chartScrollerA">
                  <div class="chartInner">
                    <div class="chartMount" id="chartMountA"></div>
                  </div>
                </div>
              </div>
              <div class="hint">
                <span class="tapHint" id="flipHintA">ğŸ‘† ã‚¿ãƒƒãƒ—ã§ã€Œç·è³‡ç”£ã®æ¨ç§»ã€ã«åˆ‡æ›¿</span>
              </div>
            </div>
          </div>

          <!-- BACKï¼šç·è³‡ç”£ -->
          <div class="cardFace back">
            <div class="cardHead">
              <div class="title">
                <div class="h" id="chartTitleB">ç·è³‡ç”£ã®æ¨ç§»</div>
                <div class="s">æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼šéå»1å¹´åˆ†ï¼ˆè¡¨ç¤ºä¸­ç¯„å›²ã§ç¸¦è»¸ãŒè‡ªå‹•èª¿æ•´ï¼‰</div>
              </div>
              <div class="badgeBig">
                <div class="k" id="metricLabelB">ç·è³‡ç”£</div>
                <div class="v" id="metricValueB">â€”</div>
              </div>
            </div>

            <div class="chartWrap">
              <div class="chartFrame">
                <div class="yAxisFixed" id="yAxisFixedB"></div>
                <div class="chartScroller" id="chartScrollerB">
                  <div class="chartInner">
                    <div class="chartMount" id="chartMountB"></div>
                  </div>
                </div>
              </div>
              <div class="hint">
                <span class="tapHint" id="flipHintB">ğŸ‘† ã‚¿ãƒƒãƒ—ã§ã€Œå—æ³¨ä»¶æ•°ã®æ¨ç§»ã€ã«åˆ‡æ›¿</span>
              </div>
            </div>
          </div>

        </div>
      </section>

      <!-- 2) ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
      <section class="card">
        <div class="cardHead">
          <div class="title">
            <div class="h">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
            <div class="s">äºˆå®šæ—¥ã®å¹ãå‡ºã—ã«âœï¸ã‚’ä»˜ã‘ã¦æ—¥ä»˜å¤‰æ›´ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰</div>
          </div>
          <div class="badgeBig">
            <div class="k">è¡¨ç¤ºæœˆ</div>
            <div class="v" id="monthLabelMini">â€”</div>
          </div>
        </div>

        <div class="secCal">
          <div class="calendar">
            <div class="calBox" id="calBox">
              <div class="calTop">
                <div class="calTopLeft">
                  <button class="todayBtn" id="todayBtn" type="button">today</button>
                  <button class="navBtn" id="prevBtn" type="button">â‰ª</button>
                  <button class="navBtn" id="nextBtn" type="button">â‰«</button>
                </div>

                <div class="monthLabel" id="monthLabel">----</div>

                <div class="calTopRight">
                  <button class="modeBtn" id="modeBtn" type="button">Sunâ€“Sat</button>
                </div>
              </div>

              <div class="calViewport" id="calViewport"></div>
            </div>
          </div>
        </div>
      </section>

      
      <!-- 3) å—æ³¨æ®‹ï¼šstock -->
      <section class="card">
        <div class="listTitle">å—æ³¨æ®‹ï¼šstock</div>
        <div class="list secOrders" id="secStock">
          <div class="tableWrap">
            <table class="ordersTable" aria-label="stock orders">
              <thead class="thead">
                <tr>
                  <th style="min-width:180px;">åå‰</th>
                  <th style="width:78px;">æ—¥ä»˜</th>
                  <th style="width:78px;">ç¨®åˆ¥</th>
                  <th style="min-width:140px;">æ‹…å½“</th>
                  <th style="width:98px;">é€²æ—</th>
                </tr>
              </thead>
              <tbody id="tbodyStock"></tbody>
            </table>
            <div id="emptyStock" class="emptyOrders" style="display:none;">è¡¨ç¤ºã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
          </div>
        </div>
      </section>

      <!-- 4) å—æ³¨æ®‹ï¼šorder -->
<!-- 4) å—æ³¨æ®‹ï¼šorder -->
      <section class="card">
        <div class="listTitle">å—æ³¨æ®‹ï¼šorder</div>
        <div class="list secOrders" id="secOrder">
          <div class="tableWrap">
            <table class="ordersTable" aria-label="made-to-order">
              <thead class="thead">
                <tr>
                  <th style="width:46%;">åå‰</th>
                  <th style="width:22%;">æœŸæ—¥</th>
                  <th style="width:20%;">é€²æ—</th>
                  <th style="width:12%; text-align:right;">æ‹…å½“</th>
                </tr>
              </thead>
              <tbody id="tbodyOrder"></tbody>
            </table>
            <div id="emptyOrder" class="emptyOrders" style="display:none;">è¡¨ç¤ºã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆãƒãƒ«ã‚·ã‚§ä»¥å¤–ã®è³¼å…¥å±¥æ­´ãŒæœªä½œæˆï¼‰</div>
          </div>
        </div>
      </section>

      <!-- Stock/Order å…±é€šï¼šBottom sheet -->
      <div class="enueOverlay" id="overlayOrders" role="dialog" aria-modal="true">
        <div class="enueSheet" onclick="event.stopPropagation()">
          <div class="enueSheetHead">
            <div id="sheetTitle">ç·¨é›†</div>
            <button class="enueBtn enueBtnGhost" style="flex:0 0 auto; padding:10px 12px;" id="closeBtn">é–‰ã˜ã‚‹</button>
          </div>
          <div class="enueSheetBody" id="sheetBody"></div>
          <div class="enueSheetFoot" id="sheetFoot" style="display:none;">
            <button class="enueBtn enueBtnGhost" id="cancelBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button class="enueBtn enueBtnPrimary" id="saveBtn">ä¿å­˜</button>
          </div>
        </div>
      </div>

      <input class="enueHiddenDate" id="datePicker" type="date" />
    </main>

    <!-- OTHER -->
    <main id="view-other" class="grid" style="display:none;">
      <section class="card otherCard">
        <div class="tileGrid" id="tileGrid">

          <!-- POSï¼ˆãƒ¬ã‚¸ã‚¢ã‚¤ã‚³ãƒ³ä»˜ãï¼‰ -->
          <button class="tile" type="button" data-href="pos.html" aria-label="POSã¸">
            <div class="tileIcon" aria-hidden="true">
              <!-- ãƒ¬ã‚¸ï¼ˆé»’ç·šï¼‰SVG -->
              <svg viewBox="0 0 24 24">
                <path d="M5 10h14v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-8z"/>
                <path d="M8 10V7a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v3"/>
                <path d="M8 14h2M12 14h2M16 14h2"/>
                <path d="M8 17h2M12 17h2M16 17h2"/>
                <path d="M5 12h14"/>
                <path d="M16 5h2v3"/>
              </svg>
            </div>
            <div class="tileTitle">POS</div>
            <div class="tileSub">pos.html</div>
          </button>

          <button class="tile" type="button" data-href="categories.html">
            <div class="tileTitle">ã‚«ãƒ†ã‚´ãƒª</div>
            <div class="tileSub">categories.html</div>
          </button>

          <button class="tile" type="button" data-href="stock.html">
            <div class="tileTitle">åœ¨åº«</div>
            <div class="tileSub">stock.html</div>
          </button>

          <button class="tile" type="button" data-href="customers.html">
            <div class="tileTitle">é¡§å®¢ç®¡ç†</div>
            <div class="tileSub">customers.html</div>
          </button>

          <button class="tile" type="button" data-href="order.html">
            <div class="tileTitle">ã‚ªãƒ¼ãƒ€ãƒ¼</div>
            <div class="tileSub">order.html</div>
          </button>

          <button class="tile" type="button" data-href="shipping.html">
            <div class="tileTitle">ç™ºé€</div>
            <div class="tileSub">shipping.html</div>
          </button>

          <button class="tile" type="button" data-href="sales.html">
            <div class="tileTitle">å£²ä¸Š</div>
            <div class="tileSub">sales.html</div>
          </button>

          <button class="tile" type="button" data-href="income.html">
            <div class="tileTitle">å…¥é‡‘</div>
            <div class="tileSub">income.html</div>
          </button>

          <button class="tile" type="button" data-href="analytics.html">
            <div class="tileTitle">åˆ†æ</div>
            <div class="tileSub">analytics.html</div>
          </button>

        </div>
      </section>
    </main>
  </div>

<script type="module">
import {
  collection, query, orderBy, getDocs,
  doc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ===== è¨­å®š ===== */
const SALES_COL = "sales";
const STOCK_TBODY_ID = "stockTbody"; // â† HTMLã®tbody idã¨ä¸€è‡´ã•ã›ã‚‹

/* ===== util ===== */
const pad2 = n => String(n).padStart(2,"0");

function toDate(v){
  if(!v) return null;
  if(typeof v === "object" && v.seconds) return new Date(v.seconds * 1000);
  if(typeof v === "number") return new Date(v);
  const d = new Date(v);
  return isNaN(d) ? null : d;
}
function fmtMMDD(v){
  const d = toDate(v);
  return d ? `${pad2(d.getMonth()+1)}/${pad2(d.getDate())}` : "--/--";
}
const arr = v => Array.isArray(v) ? v : [];

/* ===== UI ===== */
function chip(text, active){
  const el = document.createElement("div");
  el.textContent = text;
  el.style.padding = "6px 10px";
  el.style.borderRadius = "999px";
  el.style.border = "1px solid rgba(0,0,0,.15)";
  el.style.fontSize = "13px";
  el.style.fontWeight = "600";
  el.style.cursor = "pointer";
  el.style.userSelect = "none";
  el.style.background = active ? "rgba(0,0,0,.12)" : "rgba(255,255,255,.7)";
  return el;
}

/* ===== Firestoreæ›´æ–° ===== */
async function toggleAssignee(id, current){
  const cur = new Set(arr(current));
  const targets = ["è—¤åŸ","å·åŸ"];

  for(const t of targets){
    const on = cur.has(t);
    if(confirm(`æ‹…å½“ï¼š${t}\nç¾åœ¨ï¼š${on ? "ON" : "OFF"}\nåˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ`)){
      on ? cur.delete(t) : cur.add(t);
    }
  }
  const next = [...cur];
  await updateDoc(doc(db, SALES_COL, id), { assignees: next });
  return next;
}

async function nextProgress(id, current){
  const list = ["æœªç€æ‰‹","é€²è¡Œä¸­","å®Œäº†"];
  const i = list.indexOf(current);
  const next = list[(i + 1) % list.length];
  await updateDoc(doc(db, SALES_COL, id), { progress: next });
  return next;
}

/* ===== render ===== */
function renderStock(rows){
  const tbody = document.getElementById(STOCK_TBODY_ID);
  if(!tbody) return;
  tbody.innerHTML = "";

  rows.forEach(r=>{
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${r.customerName || "-"}</td>
      <td>${fmtMMDD(r.created)}</td>
      <td>${r.kind}</td>
      <td class="assignees"></td>
      <td class="progress"></td>
    `;

    /* æ‹…å½“ */
    const aCell = tr.querySelector(".assignees");
    aCell.style.display = "flex";
    aCell.style.gap = "6px";
    aCell.style.flexWrap = "wrap";

    const a = arr(r.assignees);
    const f = chip("è—¤åŸ", a.includes("è—¤åŸ"));
    const k = chip("å·åŸ", a.includes("å·åŸ"));

    const openAssign = async ()=>{
      const next = await toggleAssignee(r.id, r.assignees);
      r.assignees = next;
      f.style.background = next.includes("è—¤åŸ") ? "rgba(0,0,0,.12)" : "rgba(255,255,255,.7)";
      k.style.background = next.includes("å·åŸ") ? "rgba(0,0,0,.12)" : "rgba(255,255,255,.7)";
    };
    f.onclick = openAssign;
    k.onclick = openAssign;
    aCell.append(f,k);

    /* é€²æ— */
    const pCell = tr.querySelector(".progress");
    const p = chip(r.progress, false);
    p.onclick = async ()=>{
      const next = await nextProgress(r.id, r.progress);
      r.progress = next;
      p.textContent = next;
      if(next === "å®Œäº†") tr.remove(); // è¡¨ç¤ºãƒ«ãƒ¼ãƒ«é€šã‚Š
    };
    pCell.appendChild(p);

    tbody.appendChild(tr);
  });
}

/* ===== load ===== */
async function loadStock(){
  const q = query(
    collection(db, SALES_COL),
    orderBy("clientCreatedAt","asc")
  );
  const snap = await getDocs(q);

  const rows = snap.docs.map(d=>{
    const v = d.data();
    return {
      id: d.id,
      customerName: v.customerName,
      channel: v.channel,
      kind: v.kind ?? "stock",
      progress: v.progress ?? "æœªç€æ‰‹",
      assignees: v.assignees ?? [],
      created: v.clientCreatedAt ?? v.createdAt
    };
  }).filter(r =>
    r.channel !== "ãƒãƒ«ã‚·ã‚§" &&
    r.kind === "stock" &&
    r.progress !== "å®Œäº†"
  );

  renderStock(rows);
}

loadStock().catch(console.error);
</script>

</body>
</html>
